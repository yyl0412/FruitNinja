# FruitNinja

这是一个基于 **OpenCV** 和 **MediaPipe** 开发的手势控制版水果忍者游戏，通过摄像头追踪食指指尖运动模拟切割动作，结合动态难度、连击系统、音效反馈等经典水果忍者核心玩法，支持暂停、重启、倒计时等完整游戏流程。

## 🌟 功能特点

- **手势追踪**：使用MediaPipe检测食指指尖，轨迹绘制刀光效果，切割判定精准
- **动态难度**：游戏过程中难度逐步提升（水果生成频率加快、移动速度提高）
- **连击系统**：短时间内连续切割水果触发连击，得分加成+连击视觉特效
- **多水果类型**：支持苹果、香蕉、桃子、西瓜、草莓5种水果，不同水果对应不同分值
- **炸弹惩罚**：切割炸弹扣除生命值，生命值为0游戏结束
- **完整游戏流程**：包含教程界面、3秒倒计时、游戏暂停/重启/退出、游戏结束结算
- **音效反馈**：切割水果/炸弹触发对应音效，增强沉浸感
- **视觉特效**：水果切割生成碎片+粒子效果、刀光轨迹、连击文字、生命值/得分HUD

## 📋 环境要求

- Python 3.7+
- 依赖库：
  - ```Plain
    opencv-python
    mediapipe
    numpy
    pygame
    ```

## 🛠️ 安装步骤

### 1. 克隆/下载项目

将项目文件完整下载到本地，确保文件结构完整。

### 2. 安装依赖

创建虚拟环境（可选但推荐），然后安装所需依赖：

```Bash
# 安装依赖
pip install opencv-python mediapipe numpy pygame
```

### 3. 准备资源文件

在项目根目录创建 `assets` 文件夹，放入以下资源（缺失时会使用占位符/默认效果）：

| 资源类型 | 文件名示例                    | 说明                              |
| -------- | ----------------------------- | --------------------------------- |
| 背景图   | `background.jpg`              | 游戏背景图，尺寸建议1280x720      |
| 音效     | `slice.mp3` / `bomb.mp3`      | 切割水果/炸弹的音效文件           |
| 水果图片 | `apple.png` / `banana.png`    | 水果原图（支持透明通道，PNG格式） |
| 水果半图 | `apple_1.png` / `apple_2.png` | 水果切割后的左右/上下半图         |
| 炸弹图片 | `bomb.png`                    | 炸弹原图（支持透明通道，PNG格式） |

> 提示：缺失图片时会自动绘制彩色圆形占位符，缺失音效时无声音反馈。

## 🎮 运行游戏

在项目根目录执行：

```Bash
python main.py
```

### 操作说明

| 按键/操作    | 功能                 |
| ------------ | -------------------- |
| S            | 教程界面开始游戏     |
| P            | 游戏中暂停/恢复游戏  |
| R            | 游戏结束界面重启游戏 |
| Q            | 任意界面退出游戏     |
| 食指指尖滑动 | 切割水果（避开炸弹） |

## 📁 项目结构

```Plain
├── main.py          # 主程序（游戏逻辑、手势追踪、界面渲染）
├── config.py        # 配置文件（屏幕尺寸、重力、颜色、水果参数）
├── resources.py     # 资源管理器（加载图片、音效、背景）
├── entities.py      # 游戏实体类（水果/炸弹/粒子/碎片）
├── utils.py         # 工具函数（透明图像叠加、旋转）
├── ui.py            # 界面绘制（教程界面、文字渲染）
└── assets/          # 资源文件夹（图片、音效、背景）
```

### 文件说明

| 文件           | 核心功能                                                     |
| -------------- | ------------------------------------------------------------ |
| `main.py`      | 初始化摄像头/手势追踪，处理游戏状态（菜单/倒计时/游戏中/暂停/结束），碰撞检测 |
| `config.py`    | 定义屏幕分辨率、重力参数、颜色配置、水果分值/尺寸/颜色等常量 |
| `resources.py` | 加载背景、音效、水果/炸弹图片，提供音效播放接口              |
| `entities.py`  | 实现`GameObject`（水果/炸弹/碎片）和`Particle`（粒子特效）的运动/绘制逻辑 |
| `utils.py`     | 实现带透明通道的图像叠加（支持旋转），是游戏绘图的核心工具函数 |
| `ui.py`        | 绘制教程界面，包含玩法说明、水果分值展示、开始按钮提示       |

## 🎯 游戏规则

1. **得分规则**：
   1. 不同水果对应基础分值：苹果(1)、香蕉(2)、桃子(3)、西瓜(4)、草莓(5)
   2. 连击加成：2.5秒内连续切割水果触发连击，每多1连击额外+1分
2. **生命值**：初始3条生命，切割炸弹扣除1条，生命值为0游戏结束
3. **动态难度**：
   1. 每300帧（约10秒，30FPS）提升1级难度
   2. 难度提升后，水果生成频率加快（最低10帧生成1次）、移动速度提高（最高额外+5像素/帧）

## ⚙️ 自定义配置

可修改 `config.py` 调整游戏参数：

- `WIDTH/HEIGHT`：修改屏幕分辨率
- `GRAVITY`：调整水果下落的重力加速度
- `PALETTE`：修改文字/特效的颜色配置
- `FRUIT_CONFIG`：添加/修改水果类型（支持自定义scale/score/color/label）
- `COMBO_TIMEOUT`（main.py）：修改连击超时时间（默认2.5秒）

## ❗ 注意事项

1. 运行前确保摄像头可用，且无其他程序占用摄像头
2. 资源文件路径需严格匹配（`assets` 文件夹与代码文件同级）
3. 若音效无法播放，检查pygame安装是否正常，或音效文件格式是否为MP3
4. 手势追踪需要良好的光线条件，确保手部在摄像头视野内